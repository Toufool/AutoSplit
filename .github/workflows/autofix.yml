# https://autofix.ci/setup#getting-started
name: autofix.ci # needed to securely identify the workflow
on:
  pull_request:
    branches:
      - main
permissions:
  contents: read

jobs:
  autofix:
    runs-on: ubuntu-24.04-arm
    env:
      RUFF_OUTPUT_FORMAT: github
    steps:
      - uses: actions/checkout@v6
      - uses: astral-sh/setup-uv@v7
        with:
          activate-environment: true
      - run: uv sync --locked --only-group=ruff
      - run: ruff check --fix
      - run: ruff format
        # Format even if the the previous step failed
        if: ${{ !cancelled() }}

      - run: npx dprint fmt
        # Format even if the the previous step failed
        if: ${{ !cancelled() }}

      - uses: autofix-ci/action@7a166d7532b277f34e16238930461bf77f9d7ed8
        # Apply fixes even if linting failed
        if: ${{ !cancelled() }}
